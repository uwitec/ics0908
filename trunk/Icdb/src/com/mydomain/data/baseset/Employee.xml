<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Employee">
	<select id="selectEmployeeCount" resultClass="com.mydomain.bean.baseset.EmployeeBean">
			select
			count(*) as countValue
			 from employee,
			(select 
			job.jobCode,
			job.jobName,
			sd.*
			from job,
			(select 
			department.departmentCode,
			department.departmentName,
			struct.structCode,
			struct.structName
			from department,struct where department.structCode=struct.structCode) as sd
			where job.departmentCode=sd.departmentCode) as jsd,person
			where 
			employee.personCode=person.personCode 
			and employee.jobCode=jsd.jobCode
			and employee.isEnabled!=0 
			and (
			locate(#employeeCode#,employee.employeeCode)>0
			or locate(#personName#,person.personName)>0
			<!-- or jsd.structName like #structName#-->
			or locate(#jobName#,jsd.jobName)>0
			or locate(#departmentName#,jsd.departmentName)>0)
	</select>
	<select id="selectEmployeeDef" resultClass="com.mydomain.bean.baseset.EmployeeBean">
			select
			employee.employeeCode,
			employee.personCode,
			person.personName,
			jsd.structCode,
			jsd.structName,
			jsd.jobCode,
			jsd.jobName,
			jsd.departmentCode,
			jsd.departmentName,
			employee.userName,
			employee.passWord,
			employee.permissionCode,
			employee.isAlowLogin
			 from employee,
			(select 
			job.jobCode,
			job.jobName,
			sd.*
			from job,
			(select 
			department.departmentCode,
			department.departmentName,
			struct.structCode,
			struct.structName
			from department,struct where department.structCode=struct.structCode) as sd
			where job.departmentCode=sd.departmentCode) as jsd,person
			where 
			employee.personCode=person.personCode 
			and employee.jobCode=jsd.jobCode
			and employee.isEnabled!=0 
			and (
			locate(#employeeCode#,employee.employeeCode)>0
			or locate(#personName#,person.personName)>0
			<!-- or jsd.structName like #structName#-->
			or locate(#jobName#,jsd.jobName)>0
			or locate(#departmentName#,jsd.departmentName)>0)
			limit #startValue#,#endValue#
	</select>
	<select id="getEmployeeBean" parameterClass="String" resultClass="com.mydomain.bean.baseset.EmployeeBean">
			select
			employee.employeeCode,
			employee.personCode,
			person.personName,
			jsd.structCode,
			jsd.structName,
			jsd.jobCode,
			jsd.jobName,
			jsd.departmentCode,
			jsd.departmentName,
			employee.userName,
			employee.passWord,
			employee.permissionCode,
			employee.isAlowLogin
			 from employee,
			(select 
			job.jobCode,
			job.jobName,
			sd.*
			from job,
			(select 
			department.departmentCode,
			department.departmentName,
			struct.structCode,
			struct.structName
			from department,struct where department.structCode=struct.structCode) as sd
			where job.departmentCode=sd.departmentCode) as jsd,person
			where 
			employee.personCode=person.personCode 
			and employee.jobCode=jsd.jobCode
			and employee.isEnabled=1 
			and employee.employeeCode=#employeeCode#
	</select>
	<select id="loginEmp" parameterClass="com.mydomain.bean.baseset.EmployeeBean" resultClass="com.mydomain.bean.baseset.EmployeeBean">
		select
			employee.employeeCode,
			employee.personCode,
			person.personName,
			jsd.structCode,
			jsd.structName,
			jsd.jobCode,
			jsd.jobName,
			jsd.departmentCode,
			jsd.departmentName,
			employee.userName,
			employee.passWord,
			employee.permissionCode,
			employee.isAlowLogin
			 from employee,
			(select 
			job.jobCode,
			job.jobName,
			sd.*
			from job,
			(select 
			department.departmentCode,
			department.departmentName,
			struct.structCode,
			struct.structName
			from department,struct where department.structCode=struct.structCode) as sd
			where job.departmentCode=sd.departmentCode) as jsd,person
			where 
			employee.personCode=person.personCode 
			and employee.jobCode=jsd.jobCode
			and employee.isEnabled=1 
			and employee.userName=#userName# and employee.passWord=#passWord#
	</select>
	
	<insert id="insertEmployeeBean" parameterClass="com.mydomain.bean.baseset.EmployeeBean">
			insert into 
			employee
			(employeeCode,personCode,jobCode,isEnabled,userName,passWord,permissionCode,isAlowLogin)
			values
			(#employeeCode#,#personCode#,#jobCode#,1,#userName#,#passWord#,#permissionCode#,#isAlowLogin#)
	</insert>
	<update id="updateEmployeeBean" parameterClass="com.mydomain.bean.baseset.EmployeeBean">
			update employee
			set
			personCode=#personCode#,
			jobCode=#jobCode#,
			isEnabled=1
			where employeeCode=#employeeCode#
	</update>
	<update id="updateUserPermission" parameterClass="com.mydomain.bean.baseset.EmployeeBean">
			update employee
			set
			permissionCode=#permissionCode#,
			isEnabled=1
			where employeeCode=#employeeCode#
	</update>
	<update id="updateUserPassword" parameterClass="com.mydomain.bean.baseset.EmployeeBean">
			update employee
			set
			userName=#userName#,
			passWord=#passWord#,
			isEnabled=1
			where employeeCode=#employeeCode#
	</update>
	<delete id="deleteEmployeeBean" parameterClass="com.mydomain.bean.baseset.EmployeeBean">
			update employee
			set
			isEnabled=0
			where employeeCode=#employeeCode#
	</delete>
</sqlMap>