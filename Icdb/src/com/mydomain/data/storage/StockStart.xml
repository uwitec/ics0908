<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Stock">
	<select id="selectStockOfStoreHouse"  resultClass="com.mydomain.bean.storage.StockBean">
	Select
	s.cargoSpaceCode,
	c.cargoSpaceName,
	s.materielCode,
	m.materielName,
	s.stockPrice,
	s.stockAmount,
	s.jsonField
	from stock as s,CargoSpace as c,Materiel as m
	where
	s.cargoSpaceCode=c.cargoSpaceCode and
	s.materielCode=m.materielCode and
	s.cargoSpaceCode in
	(select cargoSpaceCode from cargoSpace where storehouseCode=#storehouseCode#)
	</select>
	<select id="selectStockDef" resultClass="com.mydomain.bean.storage.StockBean">
	Select
	count(*) as countValue
	from stock as s,CargoSpace as c,Materiel as m
	where
	s.cargoSpaceCode=c.cargoSpaceCode and
	s.materielCode=m.materielCode and
	s.cargoSpaceCode in
	(select cargoSpaceCode from cargoSpace where storehouseCode=#storehouseCode#)
	</select>
	<select id="getStockBean"  resultClass="com.mydomain.bean.storage.StockBean">
		select
		count(*) as countValue
		from stock 
		where 
		cargoSpaceCode=#cargoSpaceCode# and
		materielCode=#materielCode#
	</select>
	<insert id="insertStockBean" parameterClass="com.mydomain.bean.storage.StockBean">
	insert into stock
	(cargoSpaceCode,materielCode,stockPrice,stockAmount,jsonField)
	values(#cargoSpaceCode#,#materielCode#,#stockPrice#,#stockAmount#,#jsonField#)
	</insert>
	<update id="updateStockBean" parameterClass="com.mydomain.bean.storage.StockBean">
	update stock
	set 
	stockPrice=#stockPrice#,
	stockAmount=#stockAmount#
	where cargoSpaceCode=#cargoSpaceCode# and materielCode=#materielCode#
	</update>
	<update id="updateStockPriceBean" parameterClass="com.mydomain.bean.storage.StockBean">
	update stock
	set 
	stockPrice=#stockPrice#
	where cargoSpaceCode=#cargoSpaceCode# and materielCode=#materielCode#
	</update>
	<delete id="deleteStockBean" parameterClass="com.mydomain.bean.storage.StockBean">
	</delete>
	<update id="outStock" parameterClass="com.mydomain.bean.storage.StockBean">
	update stock
	set 
	stockAmount=stockAmount-#stockAmount#
	where cargoSpaceCode=#cargoSpaceCode# and materielCode=#materielCode#
	</update>
	<update id="inStock" parameterClass="com.mydomain.bean.storage.StockBean">
	update stock
	set 
	stockAmount=stockAmount+#stockAmount#
	where cargoSpaceCode=#cargoSpaceCode# and materielCode=#materielCode#
	</update>
	

	<!-- daiying -->
	<select id="STOCK_SELECT_BY_KEY" resultClass="com.mydomain.bean.storage.StockBean">
		select * from stock where cargoSpaceCode=#cargoSpaceCode# and materielCode=#materielCode#
	</select>
	<update id="STOCK_UPDATE_FOR_STOCK_OUT">
		update stock set stockAmount=#stockAmount#
	</update>
</sqlMap>